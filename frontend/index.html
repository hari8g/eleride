<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eleride-Bosch EV fleet orchestrator</title>
    <style>
      :root{--card-border:#e5e7eb;--muted:#6b7280;--thead:#f9fafb;--row:#ffffff;--row-alt:#fbfbfb}
      table{width:100%;border-collapse:separate;border-spacing:0}
      .u-table{font-size:14px;border:1px solid var(--card-border);border-radius:8px;overflow:hidden}
      .u-table thead th{position:sticky;top:0;background:var(--thead);border-bottom:1px solid var(--card-border);z-index:1}
      .u-table th,.u-table td{padding:10px 12px;text-align:left;vertical-align:middle;border-bottom:1px solid #f3f4f6}
      .u-table tbody tr:nth-child(odd){background:var(--row)}
      .u-table tbody tr:nth-child(even){background:var(--row-alt)}
      .u-table tbody tr:hover{background:#f6f7f9}
      .u-table td.num{text-align:right;font-variant-numeric:tabular-nums}
      .u-table th small{color:var(--muted);font-weight:400}
      /* Light, clean header color variants */
      .u-head-green thead th{background:#ecfdf5;color:#065f46}
      .u-head-amber thead th{background:#fffbeb;color:#92400e}
      .u-head-indigo thead th{background:#eef2ff;color:#3730a3}
      .u-head-purple thead th{background:#f5f3ff;color:#6d28d9}
      .u-head-cyan thead th{background:#ecfeff;color:#155e75}
      .u-head-blue thead th{background:#eff6ff;color:#1e40af}
      .u-head-rose thead th{background:#fff1f2;color:#9f1239}
      .u-head-lime thead th{background:#f7fee7;color:#3f6212}
      .u-head-slate thead th{background:#f8fafc;color:#0f172a}
      #demand-table{table-layout:fixed}
      .badge{display:inline-block;padding:2px 8px;border-radius:9999px;border:1px solid #e5e7eb;background:#f9fafb;font-size:12px}
      .chip{display:inline-block;padding:2px 8px;border-radius:6px;background:#eef2ff;border:1px solid #c7d2fe;font-size:12px}
      .dot{display:inline-block;width:10px;height:10px;border-radius:9999px;margin-right:6px}
      .dot.green{background:#10b981}.dot.yellow{background:#f59e0b}.dot.red{background:#ef4444}
      .bar{background:#e5e7eb;border-radius:6px;overflow:hidden;height:10px}
      .bar-fill{background:#10b981;height:100%}
      .table-sm td{border-bottom:1px solid #f3f4f6}
      /* Sidebar layout */
      .layout{display:flex;gap:16px}
      .sidebar{width:220px;border:1px solid var(--card-border);border-radius:10px;padding:10px;height:fit-content;position:sticky;top:16px}
      .tab-btn{display:block;width:100%;text-align:left;padding:10px 12px;margin:4px 0;border:1px solid #e5e7eb;border-radius:8px;background:#fff;cursor:pointer;font-size:14px}
      .color-demand{border-left:6px solid #10b981}
      .color-3pl{border-left:6px solid #f59e0b}
      .color-ride{border-left:6px solid #6366f1}
      .color-inc{border-left:6px solid #8b5cf6}
      .color-pay{border-left:6px solid #0ea5e9}
      .color-hot{border-left:6px solid #ef4444}
      .color-credit{border-left:6px solid #334155}
      .color-mg{border-left:6px solid #4f46e5}
      .color-energy{border-left:6px solid #06b6d4}
      .color-maint{border-left:6px solid #fb7185}
      .color-uw{border-left:6px solid #2563eb}
      .color-cf{border-left:6px solid #475569}
      .color-exp{border-left:6px solid #65a30d}
      .color-ret{border-left:6px solid #e11d48}
      .color-beckn{border-left:6px solid #0891b2}
      .color-launch{border-left:6px solid #22c55e}
    </style>
    <!-- Preload Leaflet CSS to ensure map renders even if JS loads late -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  </head>
  <body>
    <div style="max-width: 1100px; margin: 24px auto; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;">
      <h1 style="margin-bottom: 8px;">Eleride-Bosch EV fleet orchestrator</h1>
      <div id="status" style="margin-bottom: 16px;">Checking backend...</div>

      <div class="layout">
        <aside class="sidebar">
          <button id="tab-btn-demand" data-tab="demand" class="tab-btn color-demand" style="background:#f9fafb;">Demand</button>
          <button id="tab-btn-3pl" data-tab="threepl" class="tab-btn color-3pl" style="background:#fff;">3PL Capacity</button>
          <button id="tab-btn-ride" data-tab="ride" class="tab-btn color-ride" style="background:#fff;">Per-ride Earnings</button>
          <button id="tab-btn-incentives" data-tab="incentives" class="tab-btn color-inc" style="background:#fff;">Incentives</button>
          <button id="tab-btn-payouts" data-tab="payouts" class="tab-btn color-pay" style="background:#fff;">Payouts</button>
          <button id="tab-btn-hotspots" data-tab="hotspots" class="tab-btn color-hot" style="background:#fff;">Hotspots</button>
          <button id="tab-btn-credit" data-tab="credit" class="tab-btn color-credit" style="background:#fff;">Credit Profiles</button>
          <button id="tab-btn-mg" data-tab="mg" class="tab-btn color-mg" style="background:#fff;">MG Guidance</button>
          <button id="tab-btn-energy" data-tab="energy" class="tab-btn color-energy" style="background:#fff;">Energy Demand</button>
          <button id="tab-btn-maint" data-tab="maint" class="tab-btn color-maint" style="background:#fff;">Maintenance</button>
          <button id="tab-btn-uw" data-tab="uw" class="tab-btn color-uw" style="background:#fff;">Credit Underwriting</button>
          <button id="tab-btn-cf" data-tab="cf" class="tab-btn color-cf" style="background:#fff;">Cashflow</button>
          <button id="tab-btn-exp" data-tab="exp" class="tab-btn color-exp" style="background:#fff;">Expansion</button>
          <button id="tab-btn-ret" data-tab="ret" class="tab-btn color-ret" style="background:#fff;">Retention</button>
          <button id="tab-btn-beckn" data-tab="beckn" class="tab-btn color-beckn" style="background:#fff;">Beckn (Admin)</button>
          <button id="tab-btn-launch" data-tab="launch" class="tab-btn color-launch" style="background:#fff;">Launch Planner</button>
        </aside>
        <main style="flex:1;">

      <section id="tab-demand" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select"><strong>City:</strong></label>
          <select id="city-select" style="padding:6px 8px;"></select>
          <div style="margin-left:auto; opacity:0.7;">Source: analytics artifacts</div>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div id="top-store-card" style="padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:16px; align-items:center; justify-content:space-between;">
            <!-- populated by JS -->
          </div>
          <div style="padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px;">
            <h2 style="margin: 0 0 8px 0; font-size: 18px;">Store Demand (by score)</h2>
            <canvas id="demand-chart" height="240"></canvas>
          </div>
          <div style="padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow:auto; max-height: 420px;">
            <h2 style="margin: 0 0 8px 0; font-size: 18px;">Store Details</h2>
            <table id="demand-table" class="u-table u-head-green" border="0" cellpadding="0" cellspacing="0">
              <colgroup>
                <col style="width:35%">
                <col style="width:25%">
                <col style="width:20%">
                <col style="width:10%">
                <col style="width:10%">
              </colgroup>
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Score</th>
                  <th>INR P25–P75</th>
                  <th>Earning Idx</th>
                  <th>Ramp</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="insights-pane" style="padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px;">
            <h2 style="margin: 0 0 8px 0; font-size: 18px;">Store Insights</h2>
            <div id="insights-store" style="font-weight:600; margin-bottom:8px;">—</div>
            <div id="ins-metrics" style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:8px;">
              <span class="chip">Orders/Rider (week): <strong id="ins-orders-per-rider">—</strong></span>
              <span class="chip">Idle Risk: <strong id="ins-idle">—</strong></span>
              <span class="chip">Recommended Riders/day: <strong id="ins-reco">—</strong></span>
              <span class="chip">Riders/week: <strong id="ins-riders-week">—</strong></span>
            </div>
            <div style="opacity:.8;">Playbook</div>
            <div id="ins-playbook" style="margin-top:4px;">—</div>
            <hr style="margin:16px 0; border:none; border-top:1px solid #e5e7eb;" />
            <h3 style="margin:0 0 8px 0; font-size:16px;">All Stores</h3>
            <div id="insights-list" style="display:flex; flex-direction:column; gap:10px;"></div>
          </div>
        </section>
      </section>

      <section id="tab-threepl" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-3pl"><strong>City:</strong></label>
          <select id="city-select-3pl" style="padding:6px 8px;"></select>
          <div style="margin-left:auto; opacity:0.7;">For fleet partners to plan capacity</div>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px;">
            <h2 style="margin: 0 0 8px 0; font-size: 18px;">Capacity Gap by Store</h2>
            <canvas id="threepl-chart" height="260"></canvas>
          </div>
          <div style="padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow:auto; max-height: 480px;">
            <h2 style="margin: 0 0 8px 0; font-size: 18px;">3PL Planning Table</h2>
            <table id="threepl-table" class="u-table u-head-amber" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Demand Score</th>
                  <th>Orders/day</th>
                  <th>Recommended riders/day</th>
                  <th>Current riders/day (est.)</th>
                  <th>Capacity gap</th>
                  <th>Best Shift</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="tab-ride" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-ride"><strong>City:</strong></label>
          <select id="city-select-ride" style="padding:6px 8px;"></select>
          <label for="store-select-ride"><strong>Store:</strong></label>
          <select id="store-select-ride" style="padding:6px 8px;"></select>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Per-ride earning distribution</h2>
            <div id="ride-stats" style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:8px;"></div>
            <div class="bar" style="height:14px;">
              <div id="ride-range-p25" class="bar-fill" style="width:0%; background:#93c5fd;"></div>
              <div id="ride-range-med" class="bar-fill" style="width:0%; background:#3b82f6;"></div>
              <div id="ride-range-p75" class="bar-fill" style="width:0%; background:#1d4ed8;"></div>
            </div>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">All stores (city)</h2>
            <table id="ride-table" class="u-table u-head-indigo" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Avg</th>
                  <th>Median</th>
                  <th>P25</th>
                  <th>P75</th>
                  <th>Std</th>
                  <th>Samples</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="tab-incentives" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-inc"><strong>City:</strong></label>
          <select id="city-select-inc" style="padding:6px 8px;"></select>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Incentive Breakdown by Store</h2>
            <canvas id="inc-chart" height="260"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Incentives Table</h2>
            <table id="inc-table" class="u-table u-head-purple" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Base</th>
                  <th>Incentives</th>
                  <th>Surge</th>
                  <th>Peak Hour</th>
                  <th>MG</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="tab-payouts" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-pay"><strong>City:</strong></label>
          <select id="city-select-pay" style="padding:6px 8px;"></select>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Payout Components by Store</h2>
            <canvas id="pay-chart" height="260"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Payouts Table</h2>
            <table id="pay-table" class="u-table u-head-blue" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Final (GST)</th>
                  <th>Mgmt Fee</th>
                  <th>Deductions</th>
                  <th>Cash Adj</th>
                  <th>Net (arrears+deductions)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="tab-hotspots" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <div>Hotspot intensity by historical jobs</div>
        </section>
        <section style="padding:0; border: 1px solid #e5e7eb; border-radius: 8px; overflow:hidden;">
          <div id="map" style="height:480px;"></div>
        </section>
      </section>

      <section id="tab-credit" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-credit"><strong>City:</strong></label>
          <select id="city-select-credit" style="padding:6px 8px;"></select>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Credit Score Distribution</h2>
            <canvas id="credit-chart" height="240"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:480px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Driver Credit Profiles</h2>
            <table id="credit-table" class="u-table u-head-slate" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Driver</th>
                  <th>Store</th>
                  <th>Score</th>
                  <th>Band</th>
                  <th>Median INR</th>
                  <th>Orders/day</th>
                  <th>Attendance/wk</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="tab-mg" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-mg"><strong>City:</strong></label>
          <select id="city-select-mg" style="padding:6px 8px;"></select>
        </section>
        <section style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:480px;">
          <h2 style="margin:0 0 8px 0; font-size:18px;">Guidance to reach MG (per day)</h2>
          <table id="mg-table" class="u-table u-head-indigo" border="0" cellpadding="0" cellspacing="0">
            <thead>
              <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                <th>Driver</th>
                <th>Store</th>
                <th>MG/day</th>
                <th>Current/day</th>
                <th>Gap</th>
                <th>Per-ride</th>
                <th>Extra orders</th>
                <th>Extra shifts</th>
                <th>Recommendation</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
      </section>

      <section id="tab-energy" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-energy"><strong>City:</strong></label>
          <select id="city-select-energy" style="padding:6px 8px;"></select>
          <div style="margin-left:auto; opacity:.7;">kWh/week and swaps (est.)</div>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Energy Demand by Store</h2>
            <table id="energy-table" class="u-table u-head-cyan" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Orders/week</th>
                  <th>Avg km/order</th>
                  <th>Energy (kWh/week)</th>
                  <th>Swaps/week</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
            <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
              <h2 style="margin:0 0 8px 0; font-size:18px;">Weekly Energy (kWh)</h2>
              <canvas id="energy-kwh-chart" height="220"></canvas>
            </div>
            <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
              <h2 style="margin:0 0 8px 0; font-size:18px;">Estimated Swaps/Week</h2>
              <canvas id="energy-swaps-chart" height="220"></canvas>
            </div>
          </div>
        </section>
      </section>

      <section id="tab-maint" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-maint"><strong>City:</strong></label>
          <select id="city-select-maint" style="padding:6px 8px;"></select>
          <div style="margin-left:auto; opacity:.7;">Downtime risk & tickets (est.)</div>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Maintenance Risk by Store</h2>
            <table id="maint-table" class="u-table u-head-rose" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Downtime risk (%)</th>
                  <th>Tickets/week</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Downtime Risk (%)</h2>
            <canvas id="maint-risk-chart" height="240"></canvas>
          </div>
        </section>
      </section>

      <section id="tab-uw" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-uw"><strong>City:</strong></label>
          <select id="city-select-uw" style="padding:6px 8px;"></select>
          <div style="margin-left:auto; opacity:.7;">PD/LGD/EAD and Expected Loss</div>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Underwriting Table</h2>
            <table id="uw-table" class="u-table u-head-blue" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Driver</th>
                  <th>Store</th>
                  <th>Score</th>
                  <th>Monthly Median</th>
                  <th>Limit</th>
                  <th>PD</th>
                  <th>LGD</th>
                  <th>EAD</th>
                  <th>EL</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <div style="margin-top:10px; font-size:12px; line-height:1.5; color:#374151;">
              <strong>Legend</strong>:
              <ul style="margin:6px 0 0 18px;">
                <li><strong>Score</strong>: credit score (0–100) from earnings, attendance and stability</li>
                <li><strong>Monthly Median</strong>: weekly median earnings × 4</li>
                <li><strong>Limit</strong>: 1.5 × Monthly Median</li>
                <li><strong>PD</strong>: Probability of Default (mapped from score)</li>
                <li><strong>LGD</strong>: Loss Given Default (assumed 40%)</li>
                <li><strong>EAD</strong>: Exposure At Default (≈ Limit)</li>
                <li><strong>EL</strong>: Expected Loss = PD × LGD × EAD</li>
              </ul>
            </div>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Expected Loss by Driver</h2>
            <canvas id="uw-el-chart" height="260"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">PD (%) by Driver</h2>
            <canvas id="uw-pd-chart" height="260"></canvas>
          </div>
        </section>
      </section>

      <section id="tab-cf" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-cf"><strong>City:</strong></label>
          <select id="city-select-cf" style="padding:6px 8px;"></select>
          <label for="store-select-cf" style="margin-left:16px;"><strong>Store:</strong></label>
          <select id="store-select-cf" style="padding:6px 8px; min-width:220px;"></select>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Cashflow Forecast (per store)</h2>
            <canvas id="cf-chart" height="320"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Details</h2>
            <table id="cf-table" class="u-table u-head-slate" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Past (4w)</th>
                  <th>Forecast (4w)</th>
                  <th>Method</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="tab-exp" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-exp"><strong>City:</strong></label>
          <select id="city-select-exp" style="padding:6px 8px;"></select>
          <div style="margin-left:auto; opacity:.7;">ROI from demand and capacity gaps</div>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Expansion ROI (Top)</h2>
            <canvas id="exp-chart" height="280"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Ranked Opportunities</h2>
            <table id="exp-table" class="u-table u-head-lime" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>ROI score</th>
                  <th>Gap (riders/day)</th>
                  <th>Demand</th>
                  <th>Expected GMV/wk</th>
                  <th>Why</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="tab-ret" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="city-select-ret"><strong>City:</strong></label>
          <select id="city-select-ret" style="padding:6px 8px;"></select>
          <div style="margin-left:auto; opacity:.7;">At-risk riders & actions</div>
        </section>
        <section style="display:grid; grid-template-columns: 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Churn Risk by Store</h2>
            <canvas id="ret-chart" height="280"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; overflow:auto; max-height:420px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Playbook</h2>
            <table id="ret-table" class="u-table u-head-rose" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
                  <th>Store</th>
                  <th>Risk %</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="tab-beckn" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <div>Trigger sample Beckn BPP flow</div>
          <button id="beckn-btn-search" style="margin-left:auto; padding:8px 12px; border:1px solid #e5e7eb; border-radius:6px; background:#f9fafb; cursor:pointer;">Search</button>
          <button id="beckn-btn-select" style="padding:8px 12px; border:1px solid #e5e7eb; border-radius:6px; background:#f9fafb; cursor:pointer;">Select</button>
          <button id="beckn-btn-confirm" style="padding:8px 12px; border:1px solid #e5e7eb; border-radius:6px; background:#f9fafb; cursor:pointer;">Confirm</button>
          <button id="beckn-btn-status" style="padding:8px 12px; border:1px solid #e5e7eb; border-radius:6px; background:#f9fafb; cursor:pointer;">Status</button>
        </section>
        <section style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; margin-bottom:16px;">
          <h2 style="margin:0 0 8px 0; font-size:18px;">Launch Stores</h2>
          <table id="launch-table" class="u-table u-head-green" border="0" cellpadding="0" cellspacing="0">
            <thead>
              <tr>
                <th>Store</th>
                <th>City</th>
                <th>Opening</th>
                <th>Readiness</th>
                <th>Risk</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
        <section style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
          <h2 style="margin:0 0 8px 0; font-size:18px;">Logs</h2>
          <pre id="beckn-log" style="white-space:pre-wrap; background:#f8fafc; border:1px solid #e5e7eb; border-radius:6px; padding:8px; max-height:320px; overflow:auto;"></pre>
        </section>
      </section>

      <section id="tab-launch" style="display:none;">
        <section style="margin: 16px 0; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; display:flex; gap:12px; align-items:center;">
          <label for="launch-store"><strong>Store:</strong></label>
          <select id="launch-store" style="padding:6px 8px; min-width:260px;"></select>
          <div id="launch-meta" style="margin-left:auto; opacity:.8;"></div>
          <button id="launch-reprocess" style="margin-left:12px; padding:8px 12px; border:1px solid #e5e7eb; border-radius:6px; background:#f9fafb; cursor:pointer;">Rebuild from XLS</button>
        </section>
        <section style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Readiness & Insights</h2>
            <div id="launch-cards" style="display:flex; gap:12px; flex-wrap:wrap;"></div>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Staffing by Shift</h2>
            <canvas id="launch-staff-chart" height="220"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Energy Requirements</h2>
            <div id="launch-energy" style="display:flex; gap:12px; flex-wrap:wrap;"></div>
            <div style="margin-top:10px;">
              <canvas id="launch-energy-chart" height="180"></canvas>
            </div>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">4-week ROI (₹)</h2>
            <canvas id="launch-roi-chart" height="220"></canvas>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; grid-column: span 2;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">SLA Plan</h2>
            <table id="launch-sla" class="u-table u-head-slate" border="0" cellpadding="0" cellspacing="0">
              <thead><tr><th>Target (min)</th><th>Predicted (min)</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div style="padding:12px; border:1px solid #e5e7eb; border-radius:8px; grid-column: span 2;">
            <h2 style="margin:0 0 8px 0; font-size:18px;">Tasks</h2>
            <table id="launch-tasks" class="u-table u-head-lime" border="0" cellpadding="0" cellspacing="0">
              <thead><tr><th>Task</th><th>Owner</th><th>Due</th><th>Status</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>
        </main>
      </div>
    </div>

    <!-- Ensure Leaflet is available globally before our module initializes the map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module" src="/src/main.js"></script>
  </body>
  </html>


